---

datadog_enabled: "'{{ nex_env }}' == 'prod'"
datadog_api_key: "{{ vault_datadog_api_key }}"
datadog_config:
  hostname: "{{ inventory_hostname | replace( '.nexcess.net', '' ) }}"
  tags: "division:{{ nex_division | default('nexcess') }},project:{{ nex_project }},zone:{{ nex_zone }},role:{{ group_names[0] }}"
  log_level: "INFO"
datadog_base_checks:
  disk:
    init_config:
    instances:
      - use_mount: yes
  dns:
    init_config:
    default_timeout: 4
    instances:
      - hostname: "www.nexcess.net"
        nameserver: "{{ ansible_dns.nameservers[0] }}"
        timeout: 8
  network:
    init_config:
    instances:
      - collect_connection_state: false
        excluded_interfaces:
          - "lo"
          - "lo0"
datadog_checks: "{{ datadog_base_checks | combine( datadog_role_checks, recursive=true ) }}"
